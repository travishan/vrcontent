define("controller/student/next",["service/student_service","view/student/next","template"],function(t,e,s){var r,n=t("service/student_service"),i=t("view/student/next");e.buildNext=function(t,e,s){r=s;var c=$("#"+t);n.queryLastSchedule(s,function(t){n.queryClassCruxTimeNode(s,function(e){n.serviceCurrentTime(function(s){c.html(i({learnLog:t,timeNode:e,currentTime:s})),e.length>3?$(".next-progress li").css({width:($(".next-progress").width()-18)/4}):$(".next-progress li").css({width:($(".next-progress").width()-12)/3})})})});var u=function(t,e,s,r,n,i,c,u){i=i||" # ";var a=i.split("#");if(a=a[1],a.indexOf("/chapters")>-1)return"/class/"+e+"/unit/"+s+"/chapter/"+r;if(a.indexOf("/assignments")>-1){if(a=a.substr("/assignments/".length,a.length),a=a.substr(0,a.indexOf("/")),1==c)return"/class/"+e+"/assignment/"+a;if(u&&""!=u)return"/class/"+e+"/assignment/"+a+"/submission/"+u}else{if(a.indexOf("/quizzes")>-1)return 1==c?(a=a.substr("/quizzes/".length,a.length),a=a.substr(0,a.indexOf("/")),"/class/"+e+"/quiz/"+a):"/class/"+e+"/quiz?chapter_id="+r;if(a.indexOf("/forums")>-1)return a=a.substr("/forums/".length,a.length),a=a.substr(0,a.indexOf("/")),void 0==a?void gxb.tips.error("发生未知错误。"):"/class/"+e+"/topic/"+a;if(a.indexOf("/videos")>-1)return"/class/"+e+"/unit/"+s+"/chapter/"+r+"#!state=chapter&chapterId="+r;if(a.indexOf("/pages")>-1)return"/class/"+e+"/unit/"+s+"/chapter/"+r+"#!state=chapter&chapterId="+r;if(a.indexOf("/topics")>-1)return a=a.substr("/topics/".length,a.length),a=a.substr(0,a.indexOf("/")),void 0==a?void gxb.tips.error("发生未知错误。"):"/class/"+e+"/topic/"+a;if(a.indexOf("/coursewares")>-1)return"/class/"+e+"/unit/"+s+"/chapter/"+r+"#!state=chapter&chapterId="+r}return""};c.on("click.learn-next","#learn-next",function(){var t=$(this),e=t.attr("unit_id"),s=t.attr("context_id"),n=t.attr("context_type"),i=t.attr("school_id"),c=t.attr("class_id")||r,a=t.attr("redirect_uri"),o=t.attr("canSubmitQuiz"),l=t.attr("submissionId"),d=u(i,c,e,s,n,a,o,l);(d+"").length>0?window.location.href=gxb.http.resloveUrl(d):window.location.href=gxb.http.resloveUrl("/class/"+c+"/unit/")})},gxb.controller.student=gxb.controller.student||{},gxb.controller.student.next=s.exports});